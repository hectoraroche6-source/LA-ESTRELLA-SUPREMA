<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LA ESTRELLA SUPREMA</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #2e4d23;
            --accent: #C0C0C0;
            --btn-grad: linear-gradient(135deg, #2e4d23, #1a2e15);
            --border-grad: linear-gradient(45deg, #2e4d23, #C0C0C0);
            --glow: rgba(46, 77, 35, 0.4);
        }

        body { 
            font-family: -apple-system, system-ui, sans-serif; margin: 0; background: #fff; 
            border: 8px solid; border-image: var(--border-grad) 1; min-height: 100vh; transition: 0.5s;
        }

        .hidden { display: none !important; }

        /* PORTADA */
        #portada {
            height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
            background-size: cover; background-position: center; position: relative; color: white; text-align: center;
        }
        #portada::before { content: ""; position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); }
        .portada-content { z-index: 10; }

        /* BOTONES ELEGANTES */
        .btn-elegant {
            padding: 15px 40px; font-weight: bold; color: white; background: var(--btn-grad);
            border: 2px solid var(--accent); border-radius: 50px; cursor: pointer;
            box-shadow: 0 0 15px var(--glow); text-transform: uppercase; transition: 0.3s;
        }

        /* TIENDA Y FILTROS */
        .container { max-width: 1000px; margin: auto; padding: 15px; }
        .category-bar { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .cat-btn { 
            padding: 8px 20px; border-radius: 20px; border: 1px solid #ddd; background: #f8f8f8; 
            white-space: nowrap; cursor: pointer; font-weight: 600;
        }
        .cat-btn.active { background: var(--btn-grad); color: white; border-color: var(--accent); }

        /* PRODUCTOS CON BORDES H√çBRIDOS */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card { 
            background: white; border-radius: 15px; overflow: hidden; position: relative;
            border: 2px solid; border-image: var(--border-grad) 1; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .card-info { padding: 10px; text-align: center; }
        .price { color: var(--primary); font-weight: bold; font-size: 1.1rem; display: block; margin: 5px 0; }

        /* CARRITO FUTURISTA */
        #cart-trigger {
            position: fixed; bottom: 25px; right: 25px; width: 65px; height: 65px;
            background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--accent); z-index: 1000; box-shadow: 0 0 20px var(--glow);
        }
        .cart-icon-svg { width: 30px; height: 30px; fill: var(--primary); }
        .badge {
            position: absolute; top: 0; right: 0; background: #ff3b30; color: white;
            font-size: 12px; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; 
            border-radius: 50%; font-weight: bold; border: 2px solid white;
        }

        /* MODALES */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; display:flex; justify-content:center; align-items:center; }
        .modal-content { background:white; width:90%; max-width:450px; border-radius:25px; padding:20px; max-height:80vh; overflow-y:auto; }
        input, select, textarea { width:100%; padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:10px; box-sizing: border-box; }
    </style>
</head>
<body>

<audio id="snd-add" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-click-1112.mp3"></audio>

<section id="portada">
    <div class="portada-content">
        <h1 id="txt-p-tit">LA ESTRELLA SUPREMA</h1>
        <p id="txt-p-fra">Calidad que inspira, precios que enamoran.</p>
        <button class="btn-elegant" onclick="showShop()">Entrar a la Estrella</button>
    </div>
</section>

<section id="tienda" class="hidden">
    <div class="container">
        <input type="text" id="search" placeholder="üîç Buscar producto..." onkeyup="renderShop()">
        <div id="cat-list" class="category-bar"></div>
        <div id="shop-grid" class="grid"></div>
    </div>
</section>

<div id="cart-trigger" class="hidden" onclick="openCart()">
    <svg class="cart-icon-svg" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
    <div id="cart-count" class="badge hidden">0</div>
</div>

<div id="login-zone" onclick="checkAdmin()" style="position:fixed; bottom:0; left:0; width:50px; height:50px; z-index:4000; opacity:0;"></div>
<div id="admin-btn" class="hidden" onclick="openAdmin()" style="position:fixed; top:20px; right:20px; z-index:3000; background:white; padding:10px; border-radius:50%; box-shadow:0 2px 10px rgba(0,0,0,0.2); cursor:pointer;">‚öôÔ∏è</div>

<div id="modal-admin" class="modal hidden">
    <div class="modal-content">
        <h2 style="text-align:center;">PANEL SUPREMO</h2>
        <div style="background:#f0f0f0; padding:15px; border-radius:15px; margin-bottom:10px;">
            <h4>üé® Est√©tica y Portada</h4>
            <select id="cfg-theme" onchange="updateTheme(this.value)">
                <option value="linear-gradient(45deg, #2e4d23, #C0C0C0)">Verde y Plata</option>
                <option value="linear-gradient(45deg, #bf953f, #fcf6ba)">Dorado Supremo</option>
                <option value="linear-gradient(45deg, #000, #C0C0C0)">Negro y Plata</option>
            </select>
            <input type="file" id="cfg-bg" accept="image/*" label="Cambiar Fondo">
        </div>
        <div style="background:#f0f0f0; padding:15px; border-radius:15px; margin-bottom:10px;">
            <h4>üè∑Ô∏è Gestionar Renglones</h4>
            <input id="new-cat-name" placeholder="Nueva Categor√≠a">
            <button onclick="addCategory()" style="width:100%; background:var(--primary); color:white; border:none; padding:10px; border-radius:10px;">A√±adir Categor√≠a</button>
            <div id="admin-cats-list" style="margin-top:10px;"></div>
        </div>
        <div style="background:#f0f0f0; padding:15px; border-radius:15px;">
            <h4>üì¶ Nuevo Producto</h4>
            <input id="p-name" placeholder="Nombre">
            <input id="p-price" type="number" placeholder="Precio USD">
            <select id="p-cat"></select>
            <input type="file" id="p-img" accept="image/*">
            <button onclick="saveProduct()" style="width:100%; background:green; color:white; border:none; padding:12px; border-radius:10px; margin-top:10px;">GUARDAR PRODUCTO</button>
        </div>
        <div id="admin-inv" style="margin-top:15px;"></div>
        <button onclick="closeModals()" style="width:100%; margin-top:10px;">Cerrar Panel</button>
    </div>
</div>

<div id="modal-cart" class="modal hidden">
    <div class="modal-content">
        <h2 style="text-align:center;">TU PEDIDO</h2>
        <div id="cart-items-list"></div>
        <h3 id="cart-total" style="text-align:right;">Total: $0.00 USD</h3>
        <button class="btn-elegant" style="width:100%;" onclick="sendOrder()">PEDIR POR WHATSAPP</button>
        <button onclick="closeModals()" style="width:100%; margin-top:10px; background:none; border:none; color:gray;">Cerrar</button>
    </div>
</div>

<script>
    // üî• CONFIGURACI√ìN QUE ME PASASTE
    const firebaseConfig = {
        apiKey: "AIzaSyCJbDPG-EC19g7ifX4SKF85uAsOF0ODHSo",
        authDomain: "la-estrella-suprema.firebaseapp.com",
        databaseURL: "https://la-estrella-suprema-default-rtdb.firebaseio.com",
        projectId: "la-estrella-suprema",
        storageBucket: "la-estrella-suprema.firebasestorage.app",
        messagingSenderId: "246077605279",
        appId: "1:246077605279:web:9b0556eab180f38f2369aa"
    };

    firebase.initializeApp(firebaseConfig);
    const db_ref = firebase.database().ref('tienda_suprema');

    let db = {
        pTit: "LA ESTRELLA SUPREMA",
        pFra: "Calidad que inspira, precios que enamoran.",
        pImg: "https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=1200",
        theme: "linear-gradient(45deg, #2e4d23, #C0C0C0)",
        cats: ["COMBOS", "ASEO", "C√ÅRNICOS"],
        items: []
    };

    let cart = [];
    let currentCat = 'TODOS';

    // üì° ESCUCHAR CAMBIOS EN TIEMPO REAL
    db_ref.on('value', (snapshot) => {
        const cloudData = snapshot.val();
        if (cloudData) {
            db = cloudData;
            applyStyles();
            renderCats();
            renderShop();
            renderAdminTools();
        }
    });

    function applyStyles() {
        document.getElementById('txt-p-tit').innerText = db.pTit;
        document.getElementById('txt-p-fra').innerText = db.pFra;
        document.getElementById('portada').style.backgroundImage = `url(${db.pImg})`;
        document.documentElement.style.setProperty('--border-grad', db.theme);
    }

    function renderCats() {
        const bar = document.getElementById('cat-list');
        const select = document.getElementById('p-cat');
        const allCats = ["TODOS", ...db.cats, "ARMA TU COMBO"];
        
        bar.innerHTML = '';
        select.innerHTML = '';
        allCats.forEach(c => {
            const active = currentCat === c ? 'active' : '';
            bar.innerHTML += `<button class="cat-btn ${active}" onclick="filterCat('${c}')">${c}</button>`;
            if(c !== "TODOS") select.innerHTML += `<option value="${c}">${c}</option>`;
        });
    }

    function filterCat(c) { currentCat = c; renderCats(); renderShop(); }

    function renderShop() {
        const grid = document.getElementById('shop-grid');
        grid.innerHTML = '';
        const search = document.getElementById('search').value.toLowerCase();
        
        const filtered = db.items ? db.items.filter(i => {
            const matchesSearch = i.name.toLowerCase().includes(search);
            const matchesCat = currentCat === 'TODOS' || i.cat === currentCat;
            return matchesSearch && matchesCat;
        }) : [];

        filtered.forEach(p => {
            grid.innerHTML += `
                <div class="card">
                    <img src="${p.img}">
                    <div class="card-info">
                        <b>${p.name}</b>
                        <span class="price">$${p.price.toFixed(2)} USD</span>
                        <button class="btn-elegant" style="padding:8px; width:100%; font-size:0.7rem;" onclick="addToCart(${p.id})">A√±adir üõí</button>
                    </div>
                </div>`;
        });
    }

    function addToCart(id) {
        const product = db.items.find(p => p.id === id);
        const exists = cart.find(c => c.id === id);
        if(exists) exists.qty++; else cart.push({...product, qty: 1});
        document.getElementById('snd-add').play();
        updateCartUI();
    }

    function updateCartUI() {
        const count = cart.reduce((acc, curr) => acc + curr.qty, 0);
        document.getElementById('cart-count').innerText = count;
        document.getElementById('cart-count').classList.toggle('hidden', count === 0);
    }

    function openCart() {
        const list = document.getElementById('cart-items-list');
        list.innerHTML = ''; let total = 0;
        cart.forEach(item => {
            total += item.price * item.qty;
            list.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>${item.name} x${item.qty}</span><b>$${(item.price*item.qty).toFixed(2)}</b></div>`;
        });
        document.getElementById('cart-total').innerText = `Total: $${total.toFixed(2)} USD`;
        document.getElementById('modal-cart').classList.remove('hidden');
    }

    function sendOrder() {
        let msg = "üåü *LA ESTRELLA SUPREMA* üåü%0A%0A";
        let total = 0;
        cart.forEach(p => { msg += `‚Ä¢ ${p.name} (x${p.qty}) - $${(p.price*p.qty).toFixed(2)}%0A`; total += p.price*p.qty; });
        msg += `%0Aüí∞ *TOTAL: ${total.toFixed(2)} USD*%0A%0Aüìù *DATOS:*%0Aüë§ Nombre:%0Aüìç Direcci√≥n:`;
        window.open(`https://wa.me/5358876921?text=${msg}`);
    }

    // --- FUNCIONES ADMIN (SINCRONIZADAS) ---
    function checkAdmin() {
        if(prompt("User:") === "H√âCTOR" && prompt("Pass:") === "VIRTUS123VIRTUS") {
            document.getElementById('admin-btn').classList.remove('hidden');
        }
    }

    function openAdmin() {
        renderAdminTools();
        document.getElementById('modal-admin').classList.remove('hidden');
    }

    function addCategory() {
        const name = document.getElementById('new-cat-name').value.toUpperCase();
        if(name && !db.cats.includes(name)) {
            db.cats.push(name);
            saveToCloud();
            document.getElementById('new-cat-name').value = '';
        }
    }

    function saveProduct() {
        const file = document.getElementById('p-img').files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            if(!db.items) db.items = [];
            db.items.push({
                id: Date.now(),
                name: document.getElementById('p-name').value,
                price: parseFloat(document.getElementById('p-price').value),
                cat: document.getElementById('p-cat').value,
                img: e.target.result || 'https://via.placeholder.com/150'
            });
            saveToCloud();
            alert("Producto Guardado en la Nube");
        };
        if(file) reader.readAsDataURL(file); else reader.onload({});
    }

    function renderAdminTools() {
        const catList = document.getElementById('admin-cats-list');
        catList.innerHTML = '';
        db.cats.forEach((c, i) => {
            catList.innerHTML += `<div style="display:flex; justify-content:space-between;"><span>${c}</span> <button onclick="delCat(${i})">üóëÔ∏è</button></div>`;
        });

        const inv = document.getElementById('admin-inv');
        inv.innerHTML = '<h4>Inventario Actual</h4>';
        if(db.items) db.items.forEach((p, i) => {
            inv.innerHTML += `<div style="font-size:12px; display:flex; justify-content:space-between;"><span>${p.name}</span> <button onclick="delProd(${i})">üóëÔ∏è</button></div>`;
        });
    }

    function delCat(i) { db.cats.splice(i,1); saveToCloud(); }
    function delProd(i) { db.items.splice(i,1); saveToCloud(); }
    function updateTheme(val) { db.theme = val; saveToCloud(); }

    document.getElementById('cfg-bg').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => { db.pImg = ev.target.result; saveToCloud(); };
        reader.readAsDataURL(e.target.files[0]);
    };

    function saveToCloud() { db_ref.set(db); }
    function showShop() { document.getElementById('portada').classList.add('hidden'); document.getElementById('tienda').classList.remove('hidden'); document.getElementById('cart-trigger').classList.remove('hidden'); }
    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden')); }
</script>
</body>
</html>
