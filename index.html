<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LA ESTRELLA SUPREMA.CUBA</title>
    <style>
        :root {
            --primary-color: #007bff;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #212529;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-main); transition: 0.3s; }
        .hidden { display: none !important; }

        /* --- PORTADA --- */
        #portada {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1534452203293-494d7ddbf7e0?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            color: white;
            text-align: center;
            padding: 20px;
        }

        #p-titulo { font-size: 3.5rem; margin: 0; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }
        #p-frase { font-size: 1.5rem; margin: 20px 0; font-weight: 300; }
        
        /* --- TIENDA --- */
        .container { max-width: 1000px; margin: auto; padding: 20px; }
        .header-tienda { text-align: center; margin-bottom: 30px; }
        
        .grid-productos { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card { background: var(--card-bg); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: relative; transition: 0.2s; }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .card-body { padding: 10px; text-align: center; }
        .precio { color: #28a745; font-weight: bold; font-size: 1.2rem; }

        /* --- BOTONES --- */
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .btn-principal { background-color: var(--primary-color); color: white; }
        .btn-add { width: 100%; border-radius: 0; background: var(--primary-color); color: white; }

        /* --- CARRITO FLOTANTE --- */
        #carrito-flotante { position: fixed; bottom: 20px; right: 20px; background: #28a745; color: white; padding: 15px; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; gap: 10px; z-index: 100; }

        /* --- MODALES --- */
        .modal { position: fixed; top:0; left:0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; position: relative; max-height: 80vh; overflow-y: auto; }
        .close { position: absolute; top: 10px; right: 15px; font-size: 25px; cursor: pointer; }

        /* --- ADMIN ACCESO --- */
        #huella-invisible { position: fixed; bottom: 5px; left: 5px; width: 40px; height: 40px; opacity: 0.05; cursor: pointer; z-index: 1000; }
        #btn-config { position: fixed; top: 15px; right: 15px; background: white; border-radius: 50%; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); cursor: pointer; z-index: 1000; }

        /* Panel de Control Estilos */
        .admin-item { border-bottom: 1px solid #eee; padding: 10px 0; }
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; }
        .color-box { width: 30px; height: 30px; display: inline-block; border-radius: 5px; cursor: pointer; margin: 2px; border: 1px solid #000; }

    </style>
</head>
<body>

    <audio id="audio-compra"></audio>

    <section id="portada">
        <h1 id="p-titulo">LA ESTRELLA SUPREMA.CUBA</h1>
        <p id="p-frase">Calidad que inspira, precios que enamoran.</p>
        <button class="btn btn-principal" onclick="mostrarTienda()">Ver combos</button>
    </section>

    <section id="tienda" class="hidden">
        <div class="container">
            <div class="header-tienda">
                <h2 id="t-seccion">NUESTROS COMBOS</h2>
                <p id="t-desc">Ofertas exclusivas para ti</p>
            </div>
            <div id="contenedor-secciones"></div>
        </div>
    </section>

    <div id="carrito-flotante" class="hidden" onclick="abrirCarrito()">
        üõí <span id="cart-count">0</span> - <span id="cart-total">$0</span>
    </div>

    <div id="huella-invisible" onclick="pedirLogin()">üë£</div>
    <div id="btn-config" class="hidden" onclick="abrirAdmin()">‚öôÔ∏è</div>

    <div id="modal-login" class="modal hidden">
        <div class="modal-content">
            <h3>Acceso Restringido</h3>
            <input type="text" id="user" placeholder="Usuario">
            <input type="password" id="pass" placeholder="Contrase√±a">
            <button class="btn btn-principal" onclick="validarAdmin()">Entrar</button>
            <button onclick="cerrarModales()" style="background:none; border:none; color:red; margin-top:10px; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <div id="modal-producto" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModales()">&times;</span>
            <img id="m-img" src="" style="width:100%; border-radius:10px;">
            <h2 id="m-nom"></h2>
            <p id="m-det" style="color:#666;"></p>
            <p class="precio" id="m-pre"></p>
            <button class="btn btn-principal" style="width:100%" onclick="agregarAlCarritoDesdeModal()">A√±adir al Carrito</button>
        </div>
    </div>

    <div id="modal-carrito" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModales()">&times;</span>
            <h2>Tu Pedido</h2>
            <div id="lista-carrito"></div>
            <hr>
            <h3 id="total-final">Total: $0 CUP</h3>
            <button class="btn btn-principal" style="width:100%; background:#28a745;" onclick="enviarWhatsApp()">‚úÖ Hacer Pedido</button>
        </div>
    </div>

    <div id="modal-admin" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModales()">&times;</span>
            <h2 style="text-align:center">PANEL DE CONTROL</h2>
            <button class="btn" style="background:red; color:white; width:100%" onclick="logout()">Desconectar Administrador</button>
            
            <div class="admin-item">
                <h4>‚úèÔ∏è Editar Textos</h4>
                <input type="text" id="in-titulo" placeholder="T√≠tulo Principal">
                <input type="text" id="in-frase" placeholder="Frase Portada">
                <input type="text" id="in-t-seccion" placeholder="T√≠tulo Secci√≥n Tienda">
                <button class="btn btn-principal" onclick="guardarTextos()">Guardar Textos</button>
            </div>

            <div class="admin-item">
                <h4>üé® Color de Secciones</h4>
                <div id="colores-p"></div>
            </div>

            <div class="admin-item">
                <h4>üîä Sonido de Compra</h4>
                <select id="select-audio" onchange="probarAudio()">
                    <option value="https://assets.mixkit.co/sfx/preview/mixkit-cash-register-purchase-5739.mp3">Caja Registradora</option>
                    <option value="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3">Beep Positivo</option>
                    <option value="https://assets.mixkit.co/sfx/preview/mixkit-magic-marimba-2820.mp3">Marimba</option>
                    <option value="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3">√âxito</option>
                </select>
            </div>

            <div class="admin-item">
                <h4>‚ûï Nuevo Producto/Combo</h4>
                <input type="text" id="np-nom" placeholder="Nombre">
                <input type="number" id="np-pre" placeholder="Precio CUP">
                <textarea id="np-det" placeholder="Descripci√≥n detallada"></textarea>
                <input type="text" id="np-sec" placeholder="Secci√≥n (ej: Combos)">
                <input type="file" id="np-img" accept="image/*">
                <button class="btn btn-principal" style="background:green" onclick="crearProducto()">Crear Producto</button>
            </div>
        </div>
    </div>

    <script>
        // BASE DE DATOS LOCAL
        let db = JSON.parse(localStorage.getItem('estrella_db')) || {
            titulo: "LA ESTRELLA SUPREMA.CUBA",
            frase: "Calidad que inspira, precios que enamoran.",
            tiendaTit: "NUESTROS COMBOS",
            color: "#007bff",
            audio: "https://assets.mixkit.co/sfx/preview/mixkit-cash-register-purchase-5739.mp3",
            productos: []
        };

        let carrito = [];
        let itemSeleccionado = null;

        window.onload = () => {
            aplicarConfig();
            generarColores();
        };

        function aplicarConfig() {
            document.getElementById('p-titulo').innerText = db.titulo;
            document.getElementById('p-frase').innerText = db.frase;
            document.getElementById('t-seccion').innerText = db.tiendaTit;
            document.documentElement.style.setProperty('--primary-color', db.color);
            document.getElementById('audio-compra').src = db.audio;
            renderTienda();
        }

        function mostrarTienda() {
            document.getElementById('portada').classList.add('hidden');
            document.getElementById('tienda').classList.remove('hidden');
            document.getElementById('carrito-flotante').classList.remove('hidden');
        }

        function renderTienda() {
            const cont = document.getElementById('contenedor-secciones');
            cont.innerHTML = '';
            
            // Agrupar por secciones
            const secciones = [...new Set(db.productos.map(p => p.seccion))];
            
            secciones.forEach(sec => {
                const secTit = document.createElement('h3');
                secTit.innerText = sec;
                secTit.style.marginTop = "30px";
                cont.appendChild(secTit);

                const grid = document.createElement('div');
                grid.className = 'grid-productos';
                
                db.productos.filter(p => p.seccion === sec).forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <img src="${p.img}" onclick="abrirDetalle(${p.id})">
                        <div class="card-body">
                            <div style="font-weight:bold">${p.nom}</div>
                            <div class="precio">$${p.pre}</div>
                        </div>
                        <button class="btn btn-add" onclick="agregarAlCarrito(${p.id})">A√±adir üõí</button>
                    `;
                    // Soporte Long Press
                    let timer;
                    card.onmousedown = () => timer = setTimeout(() => abrirDetalle(p.id, true), 800);
                    card.onmouseup = () => clearTimeout(timer);
                    grid.appendChild(card);
                });
                cont.appendChild(grid);
            });
        }

        // LOGICA CARRITO
        function agregarAlCarrito(id) {
            const p = db.productos.find(i => i.id === id);
            const enCart = carrito.find(i => i.id === id);
            if(enCart) enCart.cant++;
            else carrito.push({...p, cant: 1});
            
            document.getElementById('audio-compra').play();
            actualizarCarritoUI();
        }

        function actualizarCarritoUI() {
            const cant = carrito.reduce((s, i) => s + i.cant, 0);
            const total = carrito.reduce((s, i) => s + (i.pre * i.cant), 0);
            document.getElementById('cart-count').innerText = cant;
            document.getElementById('cart-total').innerText = `$${total}`;
        }

        function abrirCarrito() {
            const lista = document.getElementById('lista-carrito');
            lista.innerHTML = '';
            let total = 0;
            carrito.forEach((p, idx) => {
                total += (p.pre * p.cant);
                lista.innerHTML += `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <div><b>${p.nom}</b><br>$${p.pre}</div>
                        <div>
                            <button onclick="cambiarCant(${idx},-1)">-</button>
                            <span>${p.cant}</span>
                            <button onclick="cambiarCant(${idx},1)">+</button>
                            <button onclick="eliminarDelCart(${idx})" style="color:red; margin-left:10px;">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('total-final').innerText = `Total: $${total} CUP`;
            document.getElementById('modal-carrito').classList.remove('hidden');
        }

        function cambiarCant(idx, val) {
            carrito[idx].cant += val;
            if(carrito[idx].cant < 1) carrito[idx].cant = 1;
            abrirCarrito();
            actualizarCarritoUI();
        }

        function eliminarDelCart(idx) {
            carrito.splice(idx, 1);
            abrirCarrito();
            actualizarCarritoUI();
        }

        function enviarWhatsApp() {
            if(carrito.length === 0) return;
            let msg = "Hola, vengo de la p√°gina LA ESTRELLA SUPREMA.%0A%0A*MI PEDIDO:*%0A";
            let total = 0;
            carrito.forEach(p => {
                msg += `- ${p.nom} (x${p.cant}) - $${p.pre * p.cant}%0A`;
                total += (p.pre * p.cant);
            });
            msg += `%0A*TOTAL A PAGAR: $${total} CUP*%0A%0A_Por favor rellene sus datos de entrega:_`;
            window.open(`https://wa.me/5358876921?text=${msg}`);
        }

        // ADMIN LOGICA
        function pedirLogin() { document.getElementById('modal-login').classList.remove('hidden'); }
        function validarAdmin() {
            if(document.getElementById('user').value === "H√âCTOR" && document.getElementById('pass').value === "VIRTUS123VIRTUS") {
                document.getElementById('btn-config').classList.remove('hidden');
                cerrarModales();
                alert("Modo Administrador Activo");
            } else { alert("Error"); }
        }

        function abrirAdmin() { 
            document.getElementById('in-titulo').value = db.titulo;
            document.getElementById('in-frase').value = db.frase;
            document.getElementById('in-t-seccion').value = db.tiendaTit;
            document.getElementById('modal-admin').classList.remove('hidden'); 
        }

        function guardarTextos() {
            db.titulo = document.getElementById('in-titulo').value;
            db.frase = document.getElementById('in-frase').value;
            db.tiendaTit = document.getElementById('in-t-seccion').value;
            salvar();
        }

        function crearProducto() {
            const nom = document.getElementById('np-nom').value;
            const pre = document.getElementById('np-pre').value;
            const det = document.getElementById('np-det').value;
            const sec = document.getElementById('np-sec').value;
            const file = document.getElementById('np-img').files[0];

            if(!nom || !pre || !sec) return alert("Faltan datos");

            const reader = new FileReader();
            reader.onload = (e) => {
                db.productos.push({ id: Date.now(), nom, pre: parseInt(pre), det, seccion: sec, img: e.target.result });
                salvar();
                alert("Producto creado");
            };
            if(file) reader.readAsDataURL(file);
            else {
                db.productos.push({ id: Date.now(), nom, pre: parseInt(pre), det, seccion: sec, img: 'https://via.placeholder.com/150' });
                salvar();
            }
        }

        function salvar() {
            localStorage.setItem('estrella_db', JSON.stringify(db));
            aplicarConfig();
        }

        function logout() {
            document.getElementById('btn-config').classList.add('hidden');
            cerrarModales();
        }

        function cerrarModales() {
            document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
        }

        function abrirDetalle(id, long = false) {
            itemSeleccionado = db.productos.find(p => p.id === id);
            document.getElementById('m-img').src = itemSeleccionado.img;
            document.getElementById('m-nom').innerText = itemSeleccionado.nom;
            document.getElementById('m-pre').innerText = `$${itemSeleccionado.pre} CUP`;
            document.getElementById('m-det').innerText = itemSeleccionado.det;
            document.getElementById('modal-producto').classList.remove('hidden');
        }

        function agregarAlCarritoDesdeModal() {
            if(itemSeleccionado) agregarAlCarrito(itemSeleccionado.id);
            cerrarModales();
        }

        function generarColores() {
            const paleta = ["#007bff", "#28a745", "#dc3545", "#ffc107", "#6f42c1", "#fd7e14", "#20c997", "#17a2b8", "#343a40", "#6c757d"];
            const cont = document.getElementById('colores-p');
            paleta.forEach(c => {
                const b = document.createElement('div');
                b.className = 'color-box';
                b.style.backgroundColor = c;
                b.onclick = () => { db.color = c; salvar(); };
                cont.appendChild(b);
            });
        }
    </script>
</body>
</html>
