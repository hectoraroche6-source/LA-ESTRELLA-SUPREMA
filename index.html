<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LA ESTRELLA DE CUBA</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        /* VARIABLES DE DISE√ëO PREMIUM */
        :root {
            --bg-dark: #050505;
            --glass: rgba(255, 255, 255, 0.08);
            --gold: #d4af37;
            --text: #ffffff;
            --success: #00ff9d;
        }

        body { margin: 0; background: var(--bg-dark); color: var(--text); font-family: system-ui, -apple-system, sans-serif; overflow-x: hidden; }
        .hidden { display: none !important; }

        /* 1. PORTADA LIMPIA */
        #landing {
            position: fixed; inset: 0; z-index: 2000;
            background: #000; /* IA: Poner aqu√≠ imagen de fondo desde JS */
            background-size: cover; background-position: center;
            display: flex; justify-content: center; align-items: center;
            transition: opacity 0.8s ease;
        }
        .btn-enter {
            padding: 18px 50px; border: 1px solid var(--gold); background: rgba(0,0,0,0.6);
            color: var(--gold); font-size: 14px; letter-spacing: 3px; text-transform: uppercase;
            cursor: pointer; backdrop-filter: blur(10px); transition: 0.3s;
        }

        /* 2. TIENDA */
        #shop { padding: 20px; opacity: 0; transition: opacity 1s ease; }
        .header { text-align: center; margin-bottom: 30px; }
        .cat-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .cat-btn { background: var(--glass); border: none; padding: 10px 20px; color: white; border-radius: 20px; white-space: nowrap; }
        .cat-btn.active { background: var(--gold); color: black; font-weight: bold; }

        /* GRID PRODUCTOS */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: var(--glass); border-radius: 15px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .card-info { padding: 12px; }
        
        /* 6. CARRITO BURBUJA */
        #cart-bubble {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
            background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); z-index: 100; cursor: pointer;
        }
        
        /* PANELES (CARRITO Y ADMIN) */
        .glass-panel {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px);
            z-index: 500; display: flex; flex-direction: column; padding: 20px;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .glass-panel.open { transform: translateY(0); }

        /* BOT√ìN ADMIN INVISIBLE */
        #admin-trigger { position: fixed; bottom: 0; left: 0; width: 60px; height: 60px; z-index: 9999; }
    </style>
</head>
<body>

    <audio id="snd-click"></audio>
    <audio id="snd-cash"></audio>

    <div id="landing">
        <button class="btn-enter" onclick="enterShop()">ENTRAR A LA TIENDA</button>
    </div>

    <div id="shop" class="hidden">
        <div class="header">
            <h1 id="app-title" style="margin:0; font-weight:300; letter-spacing:2px;">LA ESTRELLA</h1>
            <p id="app-subtitle" style="font-size:12px; opacity:0.6;">Cargando...</p>
            <input type="text" id="search" placeholder="üîç Buscar..." style="width:100%; padding:12px; background:var(--glass); border:none; color:white; margin-top:15px; border-radius:10px;">
        </div>

        <div id="cat-container" class="cat-scroll"></div>
        <div id="product-grid" class="grid" style="margin-top:20px;"></div>
    </div>

    <div id="cart-bubble" onclick="toggleCart(true)">üõí <span id="cart-count" style="font-size:10px; position:absolute; top:0; right:0; background:red; border-radius:50%; width:20px; height:20px; display:flex; align-items:center; justify-content:center;">0</span></div>
    
    <div id="cart-panel" class="glass-panel">
        <h2 style="text-align:center; color:var(--gold);">TU PEDIDO</h2>
        <div id="cart-list" style="flex:1; overflow-y:auto;"></div>
        <div style="padding:20px 0; border-top:1px solid rgba(255,255,255,0.1);">
            <div style="display:flex; justify-content:space-between; font-size:1.2rem; margin-bottom:15px;">
                <span>Total:</span>
                <span id="cart-total" style="color:var(--success); font-weight:bold;">$0.00 USD</span>
            </div>
            <button onclick="checkout()" style="width:100%; padding:15px; background:white; color:black; border:none; font-weight:bold; border-radius:50px;">FINALIZAR PEDIDO</button>
            <button onclick="toggleCart(false)" style="width:100%; margin-top:10px; background:none; border:none; color:rgba(255,255,255,0.5);">Seguir comprando</button>
        </div>
    </div>

    <div id="admin-trigger" onclick="adminLogin()"></div>

    <div id="admin-panel" class="glass-panel" style="background:#111;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="color:var(--gold);">PANEL SUPREMO</h2>
            <button onclick="closeAdmin()" style="color:red; background:none; border:none;">‚úï</button>
        </div>
        <div style="flex:1; overflow-y:auto; padding-bottom:50px;">
            <details style="margin-bottom:15px; background:var(--glass); padding:10px; border-radius:10px;">
                <summary>üì¶ Nuevo Producto / Combo</summary>
                <input id="adm-name" placeholder="Nombre" style="width:100%; margin:5px 0; padding:10px;">
                <input id="adm-price" type="number" placeholder="Precio USD" style="width:100%; margin:5px 0; padding:10px;">
                <select id="adm-unit" style="width:100%; padding:10px; margin:5px 0;">
                    <option value="Unid">Unidad</option>
                    <option value="Lb">Libra (Lb)</option>
                    <option value="Kg">Kilogramo (Kg)</option>
                    <option value="Lt">Litro (Lt)</option>
                </select>
                <select id="adm-cat" style="width:100%; padding:10px; margin:5px 0;"></select>
                <label style="display:block; margin:5px 0;"><input type="checkbox" id="adm-is-custom"> Es para "Armar mi Combo"</label>
                <input type="file" id="adm-img" accept="image/*">
                <button onclick="saveProduct()" style="width:100%; padding:10px; background:var(--success); border:none; margin-top:10px;">GUARDAR</button>
            </details>
            
            <details style="margin-bottom:15px; background:var(--glass); padding:10px; border-radius:10px;">
                <summary>üé® Dise√±o & Textos</summary>
                <input id="conf-title" placeholder="T√≠tulo Tienda">
                <input id="conf-subtitle" placeholder="Subt√≠tulo">
                <button onclick="saveConfig()">Actualizar Estilo</button>
            </details>
        </div>
    </div>

    <script>
        // --- 10. CONEXI√ìN BASE DE DATOS ---
        const firebaseConfig = {
            apiKey: "AIzaSyCJbDPG-EC19g7ifX4SKF85uAsOF0ODHSo",
            authDomain: "la-estrella-suprema.firebaseapp.com",
            databaseURL: "https://la-estrella-suprema-default-rtdb.firebaseio.com",
            projectId: "la-estrella-suprema",
            storageBucket: "la-estrella-suprema.firebasestorage.app",
            messagingSenderId: "246077605279",
            appId: "1:246077605279:web:9b0556eab180f38f2369aa"
        };
        firebase.initializeApp(firebaseConfig);
        // Usamos una nueva referencia para la versi√≥n "Ultra"
        const db = firebase.database().ref('estrella_ultra_v1');

        // --- ESTADO GLOBAL ---
        let appData = { products: [], config: {} };
        let cart = [];

        // --- L√ìGICA DE INICIO ---
        db.on('value', snap => {
            const val = snap.val();
            if(val) {
                appData = val;
                renderApp();
            } else {
                // Inicializar DB si est√° vac√≠a
                db.set({
                    config: { title: "LA ESTRELLA DE CUBA", subtitle: "Versi√≥n Ultra" },
                    cats: ["TODOS", "ARMAR MI COMBO", "CIGARROS"],
                    products: [] 
                });
            }
        });

        function renderApp() {
            // IA: Completar renderizado de productos, categor√≠as y portada
            document.getElementById('app-title').innerText = appData.config.title;
            // Si hay imagen de portada en config, usarla en #landing
        }

        function enterShop() {
            document.getElementById('landing').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('landing').classList.add('hidden');
                document.getElementById('shop').classList.remove('hidden');
                document.getElementById('shop').style.opacity = '1';
            }, 800);
        }

        // --- L√ìGICA ADMIN (LOGIN SEGURO) ---
        function adminLogin() {
            // IA: Mejorar esto con un modal bonito, no usar prompt
            const u = prompt("Usuario:"); 
            const p = prompt("Contrase√±a:");
            if(u === "H√©ctor" && p === "JONIX123VIRTUS") {
                document.getElementById('admin-panel').classList.add('open');
            }
        }

        function checkout() {
            // IA: Generar enlace WhatsApp a +5358876921 con el formato de pedido
        }

        // --- IA: CONTIN√öA DESDE AQU√ç IMPLEMENTANDO LAS FUNCIONES RESTANTES ---
    </script>
</body>
</html>
