<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>La Estrella de Cuba</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#0f0f0f,#1a1a1a);
    color:white;
    overflow-x:hidden;
}

:root{
    --colorGlobal:#b11226;
}

header{
    text-align:center;
    padding:60px 20px;
}

h1{
    font-size:40px;
    letter-spacing:2px;
}

button{
    background:var(--colorGlobal);
    border:none;
    padding:12px 20px;
    color:white;
    cursor:pointer;
    border-radius:30px;
    font-weight:bold;
    transition:0.3s;
}

button:hover{
    transform:scale(1.05);
    box-shadow:0 0 15px var(--colorGlobal);
}

#tienda{
    display:none;
    padding:20px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
}

.producto{
    background:rgba(255,255,255,0.05);
    backdrop-filter:blur(10px);
    padding:15px;
    border-radius:20px;
    transition:0.3s;
}

.producto:hover{
    transform:translateY(-5px);
}

.producto img{
    width:100%;
    border-radius:15px;
}

#carrito{
    position:fixed;
    right:20px;
    bottom:20px;
    width:320px;
    max-height:80vh;
    background:rgba(0,0,0,0.7);
    backdrop-filter:blur(15px);
    border-radius:20px;
    padding:20px;
    overflow:auto;
    box-shadow:0 0 20px rgba(0,0,0,0.5);
}

input{
    padding:10px;
    width:100%;
    border-radius:10px;
    border:none;
    margin-bottom:15px;
}

#adminBtn{
    position:fixed;
    bottom:10px;
    left:10px;
    width:25px;
    height:25px;
    background:transparent;
    cursor:pointer;
}

#adminPanel{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:#000;
    padding:40px;
}

.adminBox{
    max-width:400px;
    margin:auto;
    background:#111;
    padding:30px;
    border-radius:20px;
}

</style>
</head>

<body>

<header>
    <h1 id="tituloLanding">Cargando...</h1>
    <p id="textoLanding"></p>
    <button onclick="verTienda()">VER TIENDA</button>
</header>

<div id="tienda">
    <input type="text" id="buscador" placeholder="Buscar producto..." onkeyup="buscarProducto()">
    <div class="grid" id="productos"></div>
</div>

<div id="carrito">
    <h3>ðŸ›’ Tu Pedido</h3>
    <div id="listaCarrito"></div>
    <h4>Total: $<span id="total">0</span> USD</h4>
    <button onclick="enviarWhatsApp()">Finalizar Pedido</button>
</div>

<div id="adminBtn" onclick="abrirAdmin()"></div>

<div id="adminPanel">
    <div class="adminBox">
        <h3>Panel Admin</h3>
        <input type="text" id="user" placeholder="Usuario">
        <input type="password" id="pass" placeholder="ContraseÃ±a">
        <button onclick="login()">Entrar</button>
        <div id="adminConfig" style="display:none;">
            <h4>Cambiar Color Global</h4>
            <input type="color" id="nuevoColor">
            <button onclick="guardarColor()">Guardar Cambio</button>
        </div>
    </div>
</div>

<audio id="sonido">
<source src="https://www.soundjay.com/misc/sounds/cash-register-01.mp3">
</audio>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCJbDPG-EC19g7ifX4SKF85uAsOF0ODHSo",
  authDomain: "la-estrella-suprema.firebaseapp.com",
  databaseURL: "https://la-estrella-suprema-default-rtdb.firebaseio.com",
  projectId: "la-estrella-suprema",
  storageBucket: "la-estrella-suprema.firebasestorage.app",
  messagingSenderId: "246077605279",
  appId: "1:246077605279:web:9b0556eab180f38f2369aa"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let carrito = [];
let productosGlobal = [];

window.verTienda = function(){
    document.getElementById("tienda").style.display="block";
    window.scrollTo(0,document.body.scrollHeight);
}

function renderProductos(lista){
    const cont = document.getElementById("productos");
    cont.innerHTML="";
    lista.forEach((prod,id)=>{
        cont.innerHTML+=`
        <div class="producto">
            <img src="${prod.imagen}">
            <h4>${prod.nombre}</h4>
            <p>$${prod.precio} / ${prod.unidad}</p>
            <button onclick="agregarCarrito(${id})">Agregar</button>
        </div>`;
    });
}

window.agregarCarrito = function(id){
    carrito.push(productosGlobal[id]);
    document.getElementById("sonido").play();
    actualizarCarrito();
}

function actualizarCarrito(){
    let lista = document.getElementById("listaCarrito");
    lista.innerHTML="";
    let total=0;
    carrito.forEach(p=>{
        lista.innerHTML+=`<p>${p.nombre} - $${p.precio}</p>`;
        total+=Number(p.precio);
    });
    document.getElementById("total").innerText=total.toFixed(2);
}

window.buscarProducto = function(){
    let texto = document.getElementById("buscador").value.toLowerCase();
    let filtrados = productosGlobal.filter(p=>p.nombre.toLowerCase().includes(texto));
    renderProductos(filtrados);
}

window.enviarWhatsApp = function(){
    let mensaje="Hola, vengo de LA ESTRELLA DE CUBA.%0A%0APedido:%0A";
    carrito.forEach(p=>{
        mensaje+=`${p.nombre} - $${p.precio}%0A`;
    });
    mensaje+=`%0ATotal: $${document.getElementById("total").innerText} USD`;
    window.open(`https://wa.me/5358876921?text=${mensaje}`,"_blank");
}

onValue(ref(db,"config"), snapshot=>{
    const data = snapshot.val();
    if(data){
        document.getElementById("tituloLanding").innerText=data.tituloLanding;
        document.getElementById("textoLanding").innerText=data.textoLanding;
        document.documentElement.style.setProperty('--colorGlobal', data.colorGlobal);
    }
});

onValue(ref(db,"productos"), snapshot=>{
    const data = snapshot.val();
    if(data){
        productosGlobal = Object.values(data);
        renderProductos(productosGlobal);
    }
});

window.abrirAdmin = function(){
    document.getElementById("adminPanel").style.display="block";
}

window.login = function(){
    let u=document.getElementById("user").value;
    let p=document.getElementById("pass").value;
    if(u==="HÃ©ctor" && p==="JONIX123VIRTUS"){
        document.getElementById("adminConfig").style.display="block";
    } else{
        alert("Acceso Denegado");
    }
}

window.guardarColor = function(){
    let nuevo=document.getElementById("nuevoColor").value;
    update(ref(db,"config"),{colorGlobal:nuevo});
    alert("Color actualizado");
}

</script>

</body>
</html>
