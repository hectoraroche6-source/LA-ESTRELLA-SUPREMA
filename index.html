<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LA ESTRELLA SUPREMA | GLOBAL</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        /* ESTILO SUPREMO PROFESIONAL */
        :root {
            --primary: #2e4d23;  /* Verde Militar Elegante */
            --accent: #C0C0C0;   /* Plata Premium */
            --dark: #1a2e15;
            --grad-gold: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --grad-green: linear-gradient(135deg, #2e4d23, #1a2e15);
            --border-grad: linear-gradient(45deg, #2e4d23, #C0C0C0);
            --shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            margin: 0; 
            background: #f4f4f4; 
            border: 0px solid; 
            min-height: 100vh; 
            padding-bottom: 80px; /* Espacio para el carrito flotante */
        }

        /* PORTADA */
        #portada {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-size: cover;
            background-position: center;
            position: relative;
            color: white;
            text-align: center;
            transition: opacity 0.5s ease;
        }
        #portada::before {
            content: ""; position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(2px);
        }
        .portada-content { z-index: 10; padding: 20px; }
        .portada-content h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 10px;}
        .portada-content p { font-size: 1.2rem; margin-bottom: 30px; font-style: italic; opacity: 0.9; }

        /* BOTONES */
        .btn-main {
            padding: 15px 50px; font-size: 1.1rem; font-weight: bold; color: white;
            background: var(--grad-green); border: 2px solid var(--accent);
            border-radius: 50px; cursor: pointer; box-shadow: 0 0 20px rgba(46, 77, 35, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-main:active { transform: scale(0.95); }

        /* TIENDA */
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        .hidden { display: none !important; }

        /* BUSCADOR Y FILTROS */
        .search-bar { width: 100%; padding: 15px; border-radius: 30px; border: 2px solid var(--primary); outline: none; font-size: 1rem; margin-bottom: 20px; box-shadow: var(--shadow); }
        .category-bar { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
        .cat-btn { 
            padding: 10px 20px; border-radius: 20px; border: none; background: white; 
            color: #555; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            white-space: nowrap; transition: 0.3s;
        }
        .cat-btn.active { background: var(--primary); color: white; transform: scale(1.05); }

        /* GRID PRODUCTOS */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .card { 
            background: white; border-radius: 15px; overflow: hidden; position: relative;
            box-shadow: var(--shadow); border: 1px solid #ddd; transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-3px); border-color: var(--primary); }
        .card img { width: 100%; height: 140px; object-fit: cover; border-bottom: 3px solid var(--primary); }
        .card-body { padding: 10px; text-align: center; }
        .card-title { font-size: 0.95rem; font-weight: bold; margin: 5px 0; color: #333; height: 40px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .card-price { color: var(--primary); font-size: 1.2rem; font-weight: 800; display: block; margin: 5px 0; }
        
        .add-btn { 
            width: 100%; padding: 10px; background: var(--primary); color: white; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 5px;
        }
        .add-btn:active { background: #1a2e15; }

        /* CARRITO FLOTANTE */
        #cart-float {
            position: fixed; bottom: 20px; right: 20px; width: 65px; height: 65px;
            background: var(--grad-green); border-radius: 50%; border: 3px solid var(--accent);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); z-index: 1000; cursor: pointer;
            transition: transform 0.3s;
        }
        #cart-float:active { transform: scale(0.9); }
        .cart-badge {
            position: absolute; top: -5px; right: -5px; background: red; color: white;
            width: 25px; height: 25px; border-radius: 50%; font-size: 0.8rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center; border: 2px solid white;
        }

        /* MODALES */
        .modal {
            position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85);
            z-index: 2000; display: flex; justify-content: center; align-items: flex-end; /* Mobile bottom sheet style */
        }
        .modal-content {
            background: white; width: 100%; max-width: 500px; border-radius: 20px 20px 0 0;
            padding: 25px; max-height: 85vh; overflow-y: auto; position: relative;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }

        /* ESTILOS ADMIN */
        .admin-panel input, .admin-panel select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn-delete { background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin-left: auto; }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }

    </style>
</head>
<body>

<audio id="snd-click" src="https://assets.mixkit.co/sfx/preview/mixkit-modern-technology-select-3124.mp3"></audio>

<section id="portada">
    <div class="portada-content">
        <h1 id="brand-title">LA ESTRELLA SUPREMA</h1>
        <p>Calidad Global, Precio Local</p>
        <button class="btn-main" onclick="enterShop()">VER PRODUCTOS</button>
    </div>
</section>

<section id="tienda" class="hidden">
    <div class="container">
        <div onclick="adminLogin()" style="position: absolute; top: 10px; right: 10px; width: 30px; height: 30px; opacity: 0.1; background: #000; border-radius: 50%;"></div>

        <input type="text" id="search" class="search-bar" placeholder="üîç Buscar (ej: H.Upman, Combo...)" onkeyup="renderShop()">
        
        <div id="cat-bar" class="category-bar">
            </div>

        <h3 id="current-cat-title" style="margin: 10px 0; color: var(--primary);">TODOS LOS PRODUCTOS</h3>
        <div id="grid-products" class="grid">
            <div style="text-align:center; grid-column: 1/-1; padding: 50px;">
                <p>Cargando productos de la nube...</p>
            </div>
        </div>
    </div>
</section>

<div id="cart-float" class="hidden" onclick="toggleCart()">
    <svg width="30" height="30" viewBox="0 0 24 24" fill="white"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
    <div id="badge-count" class="cart-badge hidden">0</div>
</div>

<div id="modal-cart" class="modal hidden" onclick="if(event.target===this) toggleCart()">
    <div class="modal-content">
        <h2 style="color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 10px;">üõí Tu Pedido</h2>
        <div id="cart-list" style="margin-bottom: 20px;"></div>
        <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; margin-bottom: 20px;">
            <span>TOTAL:</span>
            <span id="cart-total">$0.00 USD</span> </div>
        <button class="btn-main" style="width:100%; border-radius: 15px;" onclick="sendOrder()">ENVIAR PEDIDO POR WHATSAPP</button>
        <button onclick="toggleCart()" style="width:100%; margin-top:10px; background:none; border:none; color: #999; padding: 10px;">Cerrar</button>
    </div>
</div>

<div id="modal-admin" class="modal hidden">
    <div class="modal-content admin-panel">
        <h2 style="color: var(--primary);">‚öôÔ∏è Panel Supremo</h2>
        
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button onclick="showAdminTab('prod')" style="flex:1; padding:10px; background:#ddd; border:none; border-radius:8px;">Productos</button>
            <button onclick="showAdminTab('cat')" style="flex:1; padding:10px; background:#ddd; border:none; border-radius:8px;">Categor√≠as</button>
            <button onclick="showAdminTab('conf')" style="flex:1; padding:10px; background:#ddd; border:none; border-radius:8px;">Config</button>
        </div>

        <div id="adm-tab-prod">
            <h4>A√±adir Producto</h4>
            <input id="new-p-name" placeholder="Nombre (ej: H.Upman)">
            <input id="new-p-price" type="number" placeholder="Precio (n√∫mero)">
            <select id="new-p-cat"></select>
            <input type="file" id="new-p-img" accept="image/*">
            <button onclick="saveToCloudProd()" class="btn-main" style="width:100%; padding: 10px; font-size: 1rem;">GUARDAR EN LA NUBE</button>
            <hr>
            <h4>Borrar Productos</h4>
            <div id="adm-list-prod" style="max-height: 200px; overflow-y: auto;"></div>
        </div>

        <div id="adm-tab-cat" class="hidden">
            <h4>Nueva Categor√≠a</h4>
            <input id="new-c-name" placeholder="Nombre (ej: CIGARROS)">
            <button onclick="addCategory()" class="btn-main" style="width:100%; padding: 10px; font-size: 1rem;">CREAR CATEGOR√çA</button>
            <hr>
            <div id="adm-list-cat"></div>
        </div>

        <div id="adm-tab-conf" class="hidden">
            <h4>Imagen de Portada</h4>
            <input type="file" id="cover-img-input">
            <button onclick="changeCover()" class="btn-main" style="width:100%; padding:10px;">Actualizar Portada</button>
        </div>

        <button onclick="closeAdmin()" style="width:100%; margin-top:20px; border:1px solid #ccc; background:white; padding:10px; border-radius:10px;">Cerrar Panel</button>
    </div>
</div>

<script>
    // ---------------------------------------------------------
    // 1. CONFIGURACI√ìN FIREBASE (Tus Llaves Maestras)
    // ---------------------------------------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyCJbDPG-EC19g7ifX4SKF85uAsOF0ODHSo",
      authDomain: "la-estrella-suprema.firebaseapp.com",
      databaseURL: "https://la-estrella-suprema-default-rtdb.firebaseio.com",
      projectId: "la-estrella-suprema",
      storageBucket: "la-estrella-suprema.firebasestorage.app",
      messagingSenderId: "246077605279",
      appId: "1:246077605279:web:9b0556eab180f38f2369aa",
      measurementId: "G-B4C6VGMC3Z"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database().ref('tienda_global'); // Nodo principal en la nube

    // ---------------------------------------------------------
    // 2. VARIABLES DE ESTADO LOCAL
    // ---------------------------------------------------------
    let appData = {
        items: [],
        cats: ["COMBOS"], // Categor√≠a por defecto m√≠nima
        cover: "https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=1200"
    };
    let cart = [];
    let currentCat = 'TODOS';

    // ---------------------------------------------------------
    // 3. SINCRONIZACI√ìN EN TIEMPO REAL (La Magia)
    // ---------------------------------------------------------
    dbRef.on('value', (snapshot) => {
        const data = snapshot.val();
        
        if (!data) {
            // SI LA BASE DE DATOS EST√Å VAC√çA (Primera vez)
            // INICIALIZAMOS CON LOS DATOS QUE T√ö PEDISTE
            console.log("Inicializando base de datos...");
            appData = {
                items: [
                    { id: 1, name: "H.Upman Selecto", price: 400, cat: "CIGARROS", img: "https://via.placeholder.com/150?text=H.Upman+Selecto" },
                    { id: 2, name: "H.Upman", price: 450, cat: "CIGARROS", img: "https://via.placeholder.com/150?text=H.Upman" },
                    { id: 3, name: "Popular Rojo", price: 400, cat: "CIGARROS", img: "https://via.placeholder.com/150?text=Popular" }
                ],
                cats: ["COMBOS", "CIGARROS", "ASEO"],
                cover: "https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=1200"
            };
            // Guardamos esto en la nube para que sea permanente
            dbRef.set(appData);
        } else {
            // SI YA HAY DATOS, LOS USAMOS
            appData = data;
            if(!appData.items) appData.items = [];
            if(!appData.cats) appData.cats = ["COMBOS"];
        }

        // Renderizar todo
        updateUI();
    });

    // ---------------------------------------------------------
    // 4. FUNCIONES VISUALES
    // ---------------------------------------------------------
    function updateUI() {
        // Actualizar portada
        document.getElementById('portada').style.backgroundImage = `url(${appData.cover})`;
        
        // Actualizar Categor√≠as
        const catBar = document.getElementById('cat-bar');
        const adminCatSelect = document.getElementById('new-p-cat');
        
        let htmlCats = `<button class="cat-btn ${currentCat === 'TODOS' ? 'active' : ''}" onclick="filter('TODOS')">üåü TODOS</button>`;
        let htmlOptions = ``;

        appData.cats.forEach(c => {
            htmlCats += `<button class="cat-btn ${currentCat === c ? 'active' : ''}" onclick="filter('${c}')">${c}</button>`;
            htmlOptions += `<option value="${c}">${c}</option>`;
        });

        catBar.innerHTML = htmlCats;
        adminCatSelect.innerHTML = htmlOptions;

        // Renderizar Productos
        renderShop();
    }

    function renderShop() {
        const grid = document.getElementById('grid-products');
        const term = document.getElementById('search').value.toLowerCase();
        
        grid.innerHTML = '';

        const filtered = appData.items.filter(item => {
            const matchesCat = currentCat === 'TODOS' || item.cat === currentCat;
            const matchesSearch = item.name.toLowerCase().includes(term);
            return matchesCat && matchesSearch;
        });

        if (filtered.length === 0) {
            grid.innerHTML = `<div style="text-align:center; width:100%; grid-column:1/-1; color:#999;">No hay productos aqu√≠.</div>`;
            return;
        }

        filtered.forEach(p => {
            grid.innerHTML += `
                <div class="card">
                    <img src="${p.img}" alt="${p.name}">
                    <div class="card-body">
                        <div class="card-title">${p.name}</div>
                        <span class="card-price">$${p.price} CUP</span> <button class="add-btn" onclick="addToCart(${p.id})">
                            AGREGAR
                        </button>
                    </div>
                </div>
            `;
        });
    }

    function enterShop() {
        document.getElementById('portada').classList.add('hidden');
        document.getElementById('tienda').classList.remove('hidden');
        document.getElementById('cart-float').classList.remove('hidden');
    }

    function filter(cat) {
        currentCat = cat;
        updateUI();
    }

    // ---------------------------------------------------------
    // 5. L√ìGICA DEL CARRITO
    // ---------------------------------------------------------
    function addToCart(id) {
        const prod = appData.items.find(p => p.id === id);
        const existing = cart.find(c => c.id === id);
        
        if(existing) {
            existing.qty++;
        } else {
            cart.push({ ...prod, qty: 1 });
        }
        
        document.getElementById('snd-click').play();
        updateCartBadge();
    }

    function updateCartBadge() {
        const totalQty = cart.reduce((acc, item) => acc + item.qty, 0);
        const badge = document.getElementById('badge-count');
        badge.innerText = totalQty;
        badge.classList.toggle('hidden', totalQty === 0);
    }

    function toggleCart() {
        const modal = document.getElementById('modal-cart');
        const isHidden = modal.classList.contains('hidden');
        
        if (isHidden) {
            renderCartList();
            modal.classList.remove('hidden');
        } else {
            modal.classList.add('hidden');
        }
    }

    function renderCartList() {
        const list = document.getElementById('cart-list');
        list.innerHTML = '';
        let total = 0;

        cart.forEach((item, index) => {
            const subtotal = item.price * item.qty;
            total += subtotal;
            list.innerHTML += `
                <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:10px 0;">
                    <div>
                        <b>${item.name}</b><br>
                        <small>$${item.price} x ${item.qty}</small>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <b>$${subtotal}</b>
                        <button onclick="removeFromCart(${index})" style="background:#ff4444; color:white; border:none; border-radius:50%; width:25px; height:25px;">x</button>
                    </div>
                </div>
            `;
        });

        document.getElementById('cart-total').innerText = `$${total} CUP`; // Ojo a la moneda
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        renderCartList();
        updateCartBadge();
    }

    function sendOrder() {
        if (cart.length === 0) return alert("Tu carrito est√° vac√≠o");
        
        let msg = "üåü *PEDIDO ESTRELLA SUPREMA* üåü%0A%0A";
        let total = 0;
        
        cart.forEach(item => {
            const subtotal = item.price * item.qty;
            total += subtotal;
            msg += `‚ñ™Ô∏è ${item.name} (x${item.qty}) - $${subtotal}%0A`;
        });
        
        msg += `%0Aüí∞ *TOTAL A PAGAR: $${total}*%0A%0Aüìç *Datos de Entrega:*%0A- Nombre:%0A- Direcci√≥n:`;
        
        window.open(`https://wa.me/5358876921?text=${msg}`, '_blank');
    }

    // ---------------------------------------------------------
    // 6. PANEL DE ADMINISTRADOR (CONTROL TOTAL)
    // ---------------------------------------------------------
    function adminLogin() {
        const u = prompt("Usuario:");
        const p = prompt("Contrase√±a:");
        if (u === "H√âCTOR" && p === "VIRTUS123VIRTUS") {
            document.getElementById('modal-admin').classList.remove('hidden');
            renderAdminLists();
        } else {
            alert("Acceso Denegado");
        }
    }

    function closeAdmin() {
        document.getElementById('modal-admin').classList.add('hidden');
    }

    function showAdminTab(tab) {
        ['prod', 'cat', 'conf'].forEach(t => document.getElementById(`adm-tab-${t}`).classList.add('hidden'));
        document.getElementById(`adm-tab-${tab}`).classList.remove('hidden');
    }

    // GUARDAR PRODUCTO EN LA NUBE
    function saveToCloudProd() {
        const name = document.getElementById('new-p-name').value;
        const price = document.getElementById('new-p-price').value;
        const cat = document.getElementById('new-p-cat').value;
        const fileInput = document.getElementById('new-p-img');

        if (!name || !price) return alert("Faltan datos");

        const save = (imgData) => {
            const newItem = {
                id: Date.now(),
                name: name,
                price: parseFloat(price),
                cat: cat,
                img: imgData
            };
            
            if (!appData.items) appData.items = [];
            appData.items.push(newItem);
            
            dbRef.set(appData)
                .then(() => {
                    alert("‚úÖ Producto guardado en la nube");
                    document.getElementById('new-p-name').value = "";
                    renderAdminLists();
                })
                .catch(err => alert("Error: " + err.message));
        };

        if (fileInput.files && fileInput.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => save(e.target.result);
            reader.readAsDataURL(fileInput.files[0]);
        } else {
            save("https://via.placeholder.com/150");
        }
    }

    // GESTIONAR CATEGOR√çAS
    function addCategory() {
        const name = document.getElementById('new-c-name').value.toUpperCase();
        if (name && !appData.cats.includes(name)) {
            appData.cats.push(name);
            dbRef.set(appData);
            alert("Categor√≠a creada");
            document.getElementById('new-c-name').value = '';
            renderAdminLists();
        }
    }

    function deleteCat(index) {
        if(confirm("¬øBorrar categor√≠a?")) {
            appData.cats.splice(index, 1);
            dbRef.set(appData);
            renderAdminLists();
        }
    }

    function deleteProd(index) {
        if(confirm("¬øBorrar producto?")) {
            appData.items.splice(index, 1);
            dbRef.set(appData);
            renderAdminLists();
        }
    }

    function changeCover() {
        const file = document.getElementById('cover-img-input').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                appData.cover = e.target.result;
                dbRef.set(appData);
                alert("Portada actualizada en todos los dispositivos");
            };
            reader.readAsDataURL(file);
        }
    }

    function renderAdminLists() {
        const listP = document.getElementById('adm-list-prod');
        const listC = document.getElementById('adm-list-cat');
        
        listP.innerHTML = '';
        appData.items.forEach((p, i) => {
            listP.innerHTML += `<div class="item-row"><span>${p.name} ($${p.price})</span> <button class="btn-delete" onclick="deleteProd(${i})">üóëÔ∏è</button></div>`;
        });

        listC.innerHTML = '';
        appData.cats.forEach((c, i) => {
            listC.innerHTML += `<div class="item-row"><span>${c}</span> <button class="btn-delete" onclick="deleteCat(${i})">üóëÔ∏è</button></div>`;
        });
    }

</script>

</body>
</html>
