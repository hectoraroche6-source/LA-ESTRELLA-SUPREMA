<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Estrella de Cuba</title>

<style>
:root{
    --colorGlobal:#b11226;
}

body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:#0f0f0f;
    color:white;
    overflow-x:hidden;
}

/* PORTADA */
#landing{
    height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background-size:cover;
    background-position:center;
    text-align:center;
}

#entrarBtn{
    margin-top:20px;
    padding:14px 30px;
    border:none;
    border-radius:30px;
    background:var(--colorGlobal);
    color:white;
    font-weight:bold;
    cursor:pointer;
    transition:.3s;
}
#entrarBtn:hover{
    transform:scale(1.05);
    box-shadow:0 0 20px var(--colorGlobal);
}

/* TIENDA */
#tienda{
    display:none;
    padding:30px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
}

.producto{
    background:rgba(255,255,255,0.05);
    backdrop-filter:blur(15px);
    border-radius:20px;
    padding:15px;
    transition:.3s;
}
.producto:hover{
    transform:translateY(-5px);
}
.producto img{
    width:100%;
    border-radius:15px;
}

button{
    background:var(--colorGlobal);
    border:none;
    padding:10px 15px;
    border-radius:20px;
    color:white;
    cursor:pointer;
}

/* CARRITO BURBUJA */
#carritoIcon{
    position:fixed;
    right:20px;
    bottom:20px;
    width:65px;
    height:65px;
    border-radius:50%;
    background:var(--colorGlobal);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:22px;
    cursor:pointer;
    box-shadow:0 0 15px var(--colorGlobal);
    z-index:1000;
}

#contador{
    position:absolute;
    top:5px;
    right:8px;
    background:white;
    color:black;
    border-radius:50%;
    font-size:12px;
    padding:2px 6px;
}

#carritoPanel{
    position:fixed;
    right:20px;
    bottom:100px;
    width:320px;
    max-height:70vh;
    background:rgba(0,0,0,0.8);
    backdrop-filter:blur(20px);
    border-radius:20px;
    padding:20px;
    display:none;
    overflow:auto;
}

/* PANEL ADMIN */
#adminTrigger{
    position:fixed;
    bottom:5px;
    left:5px;
    width:20px;
    height:20px;
    cursor:pointer;
}

#adminPanel{
    display:none;
    position:fixed;
    inset:0;
    background:black;
    padding:40px;
}

.adminBox{
    max-width:400px;
    margin:auto;
    background:#111;
    padding:30px;
    border-radius:20px;
}

input{
    width:100%;
    padding:10px;
    margin-bottom:15px;
    border-radius:10px;
    border:none;
}
</style>
</head>

<body>

<!-- PORTADA -->
<div id="landing">
    <button id="entrarBtn" onclick="entrarTienda()">ENTRAR A LA TIENDA</button>
</div>

<!-- TIENDA -->
<div id="tienda">
    <h2 id="tituloTienda"></h2>
    <p id="subtituloTienda"></p>
    <div class="grid" id="productos"></div>
</div>

<!-- CARRITO -->
<div id="carritoIcon" onclick="toggleCarrito()">
ðŸ›’
<div id="contador">0</div>
</div>

<div id="carritoPanel">
    <h3>Tu Pedido</h3>
    <div id="listaCarrito"></div>
    <h4>Total: $<span id="total">0</span> USD</h4>
    <button onclick="enviarWhatsApp()">Finalizar Pedido</button>
</div>

<!-- ADMIN -->
<div id="adminTrigger" onclick="abrirAdmin()"></div>

<div id="adminPanel">
    <div class="adminBox">
        <h3>Acceso Privado</h3>
        <input type="text" id="usuario" placeholder="Usuario">
        <input type="password" id="clave" placeholder="ContraseÃ±a">
        <button onclick="login()">Entrar</button>
        <div id="adminConfig" style="display:none;">
            <h4>Cambiar Color Global</h4>
            <input type="color" id="nuevoColor">
            <button onclick="guardarColor()">Guardar Cambio</button>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCJbDPG-EC19g7ifX4SKF85uAsOF0ODHSo",
  authDomain: "la-estrella-suprema.firebaseapp.com",
  databaseURL: "https://la-estrella-suprema-default-rtdb.firebaseio.com",
  projectId: "la-estrella-suprema",
  storageBucket: "la-estrella-suprema.firebasestorage.app",
  messagingSenderId: "246077605279",
  appId: "1:246077605279:web:9b0556eab180f38f2369aa"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let carrito=[];
let productos=[];

/* ENTRAR */
window.entrarTienda=function(){
    document.getElementById("landing").style.display="none";
    document.getElementById("tienda").style.display="block";
}

/* CARRITO */
window.toggleCarrito=function(){
    let panel=document.getElementById("carritoPanel");
    panel.style.display=panel.style.display==="block"?"none":"block";
}

function actualizarCarrito(){
    let lista=document.getElementById("listaCarrito");
    lista.innerHTML="";
    let total=0;
    carrito.forEach(p=>{
        lista.innerHTML+=`<p>${p.nombre} - $${p.precio}</p>`;
        total+=Number(p.precio);
    });
    document.getElementById("total").innerText=total.toFixed(2);
    document.getElementById("contador").innerText=carrito.length;
}

window.agregarCarrito=function(id){
    carrito.push(productos[id]);
    actualizarCarrito();
}

/* WHATSAPP */
window.enviarWhatsApp=function(){
    let mensaje="Hola, vengo de LA ESTRELLA DE CUBA.%0A%0APedido:%0A";
    carrito.forEach(p=>{
        mensaje+=`${p.nombre} - $${p.precio}%0A`;
    });
    mensaje+=`%0ATotal: $${document.getElementById("total").innerText} USD`;
    window.open(`https://wa.me/5358876921?text=${mensaje}`,"_blank");
}

/* ADMIN */
window.abrirAdmin=function(){
    document.getElementById("adminPanel").style.display="block";
}

window.login=function(){
    if(
        document.getElementById("usuario").value.trim()==="HÃ©ctor" &&
        document.getElementById("clave").value==="JONIX123VIRTUS"
    ){
        document.getElementById("adminConfig").style.display="block";
    }else{
        alert("Acceso incorrecto");
    }
}

window.guardarColor=function(){
    let nuevo=document.getElementById("nuevoColor").value;
    update(ref(db,"config"),{colorGlobal:nuevo});
}

/* FIREBASE */
onValue(ref(db,"config"),snap=>{
    const d=snap.val();
    if(d){
        document.documentElement.style.setProperty('--colorGlobal', d.colorGlobal);
        document.getElementById("landing").style.backgroundImage=`url(${d.portada})`;
        document.getElementById("tituloTienda").innerText=d.titulo;
        document.getElementById("subtituloTienda").innerText=d.subtitulo;
    }
});

onValue(ref(db,"productos"),snap=>{
    const d=snap.val();
    if(d){
        productos=Object.values(d);
        let cont=document.getElementById("productos");
        cont.innerHTML="";
        productos.forEach((p,i)=>{
            cont.innerHTML+=`
            <div class="producto">
                <img src="${p.imagen}">
                <h4>${p.nombre}</h4>
                <p>$${p.precio} / ${p.unidad}</p>
                <button onclick="agregarCarrito(${i})">Agregar</button>
            </div>`;
        });
    }
});
</script>

</body>
</html>
