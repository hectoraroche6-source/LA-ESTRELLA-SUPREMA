<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LA ESTRELLA SUPREMA</title>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

<style>
:root{
--primario:#2e4d23;
--acento:#C0C0C0;
--fondo:#f4f4f4;
--blanco:#fff;
}

body{
margin:0;
font-family:system-ui;
background:var(--fondo);
}

.hidden{display:none!important;}

.app-container{
max-width:500px;
margin:auto;
padding:15px;
}

.producto-card{
background:white;
border-radius:15px;
margin-bottom:15px;
box-shadow:0 6px 15px rgba(0,0,0,0.1);
overflow:hidden;
transition:0.3s;
}

.producto-card:hover{
transform:scale(1.02);
}

.producto-img{
width:100%;
height:200px;
object-fit:cover;
}

.producto-info{
padding:15px;
}

.precio{
font-weight:bold;
font-size:18px;
color:var(--primario);
}

.btn{
padding:10px 15px;
border:none;
border-radius:25px;
cursor:pointer;
font-weight:bold;
}

.btn-primario{
background:var(--primario);
color:white;
}

.categoria-btn{
background:white;
padding:8px 15px;
border-radius:20px;
white-space:nowrap;
cursor:pointer;
border:1px solid #ddd;
}

.categoria-activa{
background:var(--primario);
color:white;
}

#btn-carrito{
position:fixed;
bottom:20px;
right:20px;
background:var(--primario);
color:white;
padding:20px;
border-radius:50%;
cursor:pointer;
z-index:100;
box-shadow:0 6px 15px rgba(0,0,0,0.2);
}

.admin-panel{
background:#eee;
padding:20px;
border-radius:15px;
}

input,textarea,select{
width:100%;
margin-bottom:10px;
padding:10px;
border-radius:10px;
border:1px solid #ccc;
}

</style>
</head>

<body>

<div id="pantalla-inicio" style="height:100vh;background:var(--primario);color:white;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;">
<h1 ondblclick="accesoAdmin()">LA ESTRELLA SUPREMA</h1>
<p>Calidad Global</p>
<button onclick="mostrarTienda()" class="btn btn-primario">ENTRAR</button>
</div>

<div id="pantalla-tienda" class="hidden">
<div class="app-container">
<input type="text" id="buscador" placeholder="ðŸ” Buscar productos..." onkeyup="filtrarProductos()">
<div id="categorias-nav" style="display:flex;gap:10px;overflow-x:auto;padding:10px 0;"></div>
<div id="lista-productos"></div>
</div>
</div>

<div id="btn-carrito" class="hidden" onclick="generarPedidoWhatsApp()">
ðŸ›’ <span id="contador-badge">0</span>
</div>

<div id="modal-admin" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:200;overflow-y:auto;">
<div class="admin-panel" style="margin:20px;">
<h3>GESTIÃ“N DE INVENTARIO</h3>
<input type="text" id="adm-nombre" placeholder="Nombre">
<textarea id="adm-desc" placeholder="DescripciÃ³n"></textarea>
<input type="number" id="adm-precio" placeholder="Precio">
<select id="adm-categoria"></select>
<input type="file" id="adm-foto" accept="image/*">
<button onclick="subirProducto()" class="btn btn-primario">GUARDAR</button>
<button onclick="cerrarAdmin()" class="btn">CERRAR</button>
</div>
</div>

<script>

const firebaseConfig = {
apiKey:"AIzaSyCJbDPG-EC19g7ifX4SKF85uAsOF0ODHSo",
authDomain:"la-estrella-suprema.firebaseapp.com",
databaseURL:"https://la-estrella-suprema-default-rtdb.firebaseio.com",
projectId:"la-estrella-suprema",
storageBucket:"la-estrella-suprema.firebasestorage.app",
messagingSenderId:"246077605279",
appId:"1:246077605279:web:9b0556eab180f38f2369aa"
};

firebase.initializeApp(firebaseConfig);
const database=firebase.database().ref('inventario_maestro');

let productos=[];
let carrito=[];
let categorias=["CIGARROS","COMBOS","ASEO","ALIMENTOS"];

function mostrarTienda(){
document.getElementById("pantalla-inicio").classList.add("hidden");
document.getElementById("pantalla-tienda").classList.remove("hidden");
document.getElementById("btn-carrito").classList.remove("hidden");
renderCategorias();
}

function renderCategorias(){
const nav=document.getElementById("categorias-nav");
nav.innerHTML="";
categorias.forEach(cat=>{
const btn=document.createElement("div");
btn.className="categoria-btn";
btn.innerText=cat;
btn.onclick=()=>filtrarPorCategoria(cat,btn);
nav.appendChild(btn);
});
}

function renderProductos(lista){
const cont=document.getElementById("lista-productos");
cont.innerHTML="";
lista.forEach(prod=>{
cont.innerHTML+=`
<div class="producto-card">
<img src="${prod.foto}" class="producto-img">
<div class="producto-info">
<h3>${prod.nombre}</h3>
<p>${prod.desc}</p>
<div class="precio">${prod.precio} CUP</div>
<button class="btn btn-primario" onclick='agregarCarrito(${JSON.stringify(prod)})'>Agregar</button>
</div>
</div>`;
});
}

function agregarCarrito(prod){
carrito.push(prod);
document.getElementById("contador-badge").innerText=carrito.length;
}

function generarPedidoWhatsApp(){
let mensaje="ðŸ›’ *PEDIDO LA ESTRELLA SUPREMA* %0A%0A";
let total=0;
carrito.forEach(p=>{
mensaje+=`â€¢ ${p.nombre} - ${p.precio} CUP %0A`;
total+=Number(p.precio);
});
mensaje+=`%0AðŸ’° Total: ${total} CUP`;
window.open(`https://wa.me/5350000000?text=${mensaje}`);
}

function filtrarProductos(){
const texto=document.getElementById("buscador").value.toLowerCase();
const filtrados=productos.filter(p=>p.nombre.toLowerCase().includes(texto));
renderProductos(filtrados);
}

function filtrarPorCategoria(cat,btn){
document.querySelectorAll(".categoria-btn").forEach(b=>b.classList.remove("categoria-activa"));
btn.classList.add("categoria-activa");
const filtrados=productos.filter(p=>p.categoria===cat);
renderProductos(filtrados);
}

function accesoAdmin(){
let user=prompt("Usuario:");
let pass=prompt("ContraseÃ±a:");
if(user==="HÃ‰CTOR" && pass==="VIRTUS123VIRTUS"){
document.getElementById("modal-admin").classList.remove("hidden");
}
}

function cerrarAdmin(){
document.getElementById("modal-admin").classList.add("hidden");
}

function comprimirImagen(file){
return new Promise(resolve=>{
const reader=new FileReader();
reader.onload=e=>{
const img=new Image();
img.onload=()=>{
const canvas=document.createElement("canvas");
const scale=400/img.width;
canvas.width=400;
canvas.height=img.height*scale;
const ctx=canvas.getContext("2d");
ctx.drawImage(img,0,0,canvas.width,canvas.height);
resolve(canvas.toDataURL("image/jpeg",0.7));
};
img.src=e.target.result;
};
reader.readAsDataURL(file);
});
}

async function subirProducto(){
const nombre=document.getElementById("adm-nombre").value;
const desc=document.getElementById("adm-desc").value;
const precio=document.getElementById("adm-precio").value;
const categoria=document.getElementById("adm-categoria").value;
const file=document.getElementById("adm-foto").files[0];

const foto=await comprimirImagen(file);

database.push({nombre,desc,precio,categoria,foto});
alert("Producto subido");
}

database.on('value',snapshot=>{
const data=snapshot.val();
productos=data?Object.values(data):[];
renderProductos(productos);
});

</script>
</body>
</html>
